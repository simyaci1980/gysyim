{% extends 'layout.html' %}
{% block content %}

<div class="text-center mb-4">
    <h1>YazÄ± Ä°ÅŸleri MÃ¼dÃ¼rlÃ¼ÄŸÃ¼ NotlarÄ±</h1>
    <p>TÃ¼rkiyeâ€™de sÄ±nava hazÄ±rlayanlar iÃ§in hazÄ±rlanmÄ±ÅŸ notlar ve rehber iÃ§erikler.</p>
</div>

<!-- Chat Kutusu -->
<div id="chat-container" class="border rounded p-3 mb-4 w-100" style="max-width:1000px; background:#fafafa;">
    <div id="chat-box" style="height:300px; overflow-y:auto; margin-bottom:10px;">
        <p><em>Merhaba! SorularÄ±nÄ±zÄ± buradan iletebilirsiniz.</em></p>
    </div>
    <form id="chat-form" class="d-flex">
        <input type="text" id="chat-input" class="form-control me-2" placeholder="MesajÄ±nÄ±zÄ± yazÄ±n...">
        <button type="submit" class="btn btn-primary">GÃ¶nder</button>
    </form>
</div>

<script>
const chatForm = document.getElementById("chat-form");
const chatInput = document.getElementById("chat-input");
const chatBox = document.getElementById("chat-box");

// ğŸ”’ XSS korumasÄ± iÃ§in gÃ¼venli metin ekleme fonksiyonu
function escapeHtml(text) {
    const div = document.createElement('div');
    div.textContent = text;
    return div.innerHTML;
}

function fetchMessages() {
    fetch("{% url 'chat_api' %}")
        .then(res => res.json())
        .then(data => {
            chatBox.innerHTML = "";
            data.forEach(msg => {
                const p = document.createElement("p");
                // ğŸ”’ textContent kullanarak XSS Ã¶nlenir
                const strong = document.createElement("strong");
                strong.textContent = msg.user + ":";
                const messageText = document.createTextNode(" " + msg.message + " ");
                const small = document.createElement("small");
                small.textContent = msg.time;
                
                p.appendChild(strong);
                p.appendChild(messageText);
                p.appendChild(small);
                chatBox.appendChild(p);
            });
            chatBox.scrollTop = chatBox.scrollHeight;
        });
}

fetchMessages();
setInterval(fetchMessages, 3000);

chatForm.addEventListener("submit", function(e){
    e.preventDefault();
    const text = chatInput.value.trim();
    if(!text) return;

    fetch("{% url 'chat_api' %}", {
        method: "POST",
        headers: {"Content-Type": "application/x-www-form-urlencoded"},
        body: `text=${encodeURIComponent(text)}`
    }).then(res => res.json())
      .then(data => {
        if(data.status === "ok") chatInput.value = "";
      });
});

</script>

<!-- Ã–deme Bildirimi -->
<div class="border rounded p-3 mb-4 w-100" style="max-width:1000px; background:#e9f7ef;">
    <h4>Ã–deme Yap</h4>
    <p>Ã–deme iÃ§in aÅŸaÄŸÄ±daki IBANâ€™a havale/EFT yapÄ±n
       <strong style="color: darkred; font-size: 1.2em;">AlÄ±cÄ± ismi: Ali AltÄ±nsoy</strong>
    </p>

    <div class="input-group mb-2">
        <input type="text" id="ibanInput" class="form-control" value="TR140001500158007286281178" readonly>
        <button class="btn btn-outline-secondary" type="button" onclick="copyIBAN()">Kopyala</button>
    </div>

    {% if user.is_authenticated %}
    <form method="post" action="{% url 'odeme_bildirim' %}">
        {% csrf_token %}
        <button type="submit" class="btn btn-success w-100">Ã–deme Bildirimi GÃ¶nder</button>
    </form>
    {% else %}
    <p class="mt-2">Ã–deme bildiriminde bulunmak iÃ§in <a href="">giriÅŸ yapÄ±n</a>.</p>
    {% endif %}
</div>

<!-- Ã–rnek Sayfalar -->
<div class="border rounded p-3 mb-4 w-100" style="max-width:1000px; background:#fef9e7;">
    <h4>Ã–rnek Sayfalar</h4>
    <ul class="list-unstyled">
        <li><a href="{% url 'ornek1' %}">Ã–rnek Sayfa 1</a></li>
        <li><a href="{% url 'darisureler' %}">Ã–rnek Sayfa 2</a></li>
        <li><a href="{% url 'bim5mad' %}">Ã–rnek Sayfa 3</a></li>
    </ul>
</div>

<!-- FaydalÄ± Linkler -->
<div class="border rounded p-3 mb-4 w-100" style="max-width:1000px; background:#f2d7d5;">
    <h4>FaydalÄ± Linkler</h4>
    <ul class="list-unstyled">
        <li><a href="https://www.adalet.gov.tr/" target="_blank">Adalet BakanlÄ±ÄŸÄ±</a></li>
        <li><a href="https://pgm.adalet.gov.tr/" target="_blank">Personel Genel MÃ¼dÃ¼rlÃ¼ÄŸÃ¼</a></li>
        <li><a href="https://odsgm.meb.gov.tr/" target="_blank">Milli EÄŸitim BakanlÄ±ÄŸÄ±</a></li>
    </ul>
</div>



{% endblock %}
